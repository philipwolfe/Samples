

<!--BEGIN HEADER-->
<html>
<head>
<link rel="stylesheet" href="../../include/qsstyle.css">
</head>
<body topmargin="0" leftmargin="0" marginwidth="0" marginheight="0" >

<table class="outer" cellpadding=0 cellspacing=0>
<tr>
<td class="toc" valign="top" width="210">
  <table>
<tr>
<td nowrap style="padding-right:15">

<div class="toc" style="font-size:8pt;color:darkred;">

            <div style="padding:0,0,4,0"><b>Getting Started</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/quickstart.htm">Introduction</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/whatisaspx.htm">What is ASP.NET?</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/langsupport.htm">Language Support</a><p>

            <div style="padding:0,0,4,0"><b>ASP.NET Web Forms</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/webformsintro.htm">Introducing Web Forms</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webserverctrls.htm">Working with Server Controls</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webtemplates.htm">Applying Styles to Controls</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webvalidation.htm">Server Control Form Validation</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webpagelets.htm">Web Forms User Controls</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webdatabinding.htm">Databinding Server Controls</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webdataaccess.htm">Server-Side Data Access</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webdatalist.htm">Data Access and Customization</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/businessobjs.htm">Working with Business Objects</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webctrlauthoring.htm">Authoring Custom Controls</a><br>
<!--            &nbsp; <a class="outer" href="../../aspplus/doc/webformsandvs7.htm">Visual Studio 7.0 & Web Forms</a><br> -->
            &nbsp; <a class="outer" href="../../aspplus/doc/webcontrolsref.htm">Web Forms Controls Reference</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webformssyntaxref.htm">Web Forms Syntax Reference</a><p>

            <div style="padding:0,0,4,0"><b>ASP.NET Web Services</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/webservicesintro.htm">Introducing Web Services</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/writingservices.htm">Writing a Simple Web Service</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webservicetypes.htm">Web Service Type Marshalling</a><br>
<!--            &nbsp; <a class="outer" href="../../aspplus/doc/discoverservices.htm">Making Services Discoverable</a><br> -->
            &nbsp; <a class="outer" href="../../aspplus/doc/servicesanddata.htm">Using Data in Web Services</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/servicesandobjs.htm">Using Objects and Intrinsics</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/htmlscraping.htm">HTML Pattern Matching</a><p>

            <div style="padding:0,0,4,0"><b>ASP.NET Web Applications</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/applications.htm">Application Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/globalasax.htm">Using the Global.asax File</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/stateoverview.htm">Managing Application State</a><br>
<!--            &nbsp; <a class="outer" href="../../aspplus/doc/httpmodules.htm">Handling HttpModule Events</a><br> -->
            &nbsp; <a class="outer" href="../../aspplus/doc/httphandlers.htm">HttpHandlers and Factories</a><p>

<!--
            <div style="padding:0,0,4,0"><b>State Management</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/stateoverview.htm">State Management Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/pageviewstate.htm">Using Page-local View State</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/sessionappstate.htm">Session and Application State</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/usingcookies.htm">Using Client-side Cookies</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/choosingstate.htm">Choosing a Strategy</a><p>
-->
            <div style="padding:0,0,4,0"><b>Cache Services</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/cachingoverview.htm">Caching Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/outputcaching.htm">Page Output Caching</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/datacaching.htm">Page Data Caching</a><p>

            <div style="padding:0,0,4,0"><b>Configuration</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/configoverview.htm">Configuration Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/configformat.htm">Configuration File Format</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/configretrieve.htm">Retrieving Configuration</a><p>

            <div style="padding:0,0,4,0"><b>Deployment</b><br></div>
<!--            &nbsp; <a class="outer" href="../../aspplus/doc/adminoverview.htm">Administration Overview</a><br> -->
            &nbsp; <a class="outer" href="../../aspplus/doc/deployment.htm">Deploying ASP.NET Applications</a><p>

            <div style="padding:0,0,4,0"><b>Security</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/securityoverview.htm">Security Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/authandauth.htm">Authentication & Authorization</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/windowsauth.htm">Windows-based Authentication</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/formsauth.htm">Forms-based Authentication</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/authorization.htm">Authorizing Users and Roles</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/impersonation.htm">User Account Impersonation</a><p>

            <div style="padding:0,0,4,0"><b>Localization</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/internationalization.htm">Internationalization Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/cultureencoding.htm">Setting Culture and Encoding</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/localizingapps.htm">Localizing ASP.NET Applications</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/resourcefiles.htm">Working with Resource Files</a><p>

            <div style="padding:0,0,4,0"><b>Tracing</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/tracingoverview.htm">Tracing Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/tracelogpage.htm">Trace Logging to Page Output</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/tracelogapp.htm">Application-level Trace Logging</a><p>

            <div style="padding:0,0,4,0"><b>Debugging</b><br></div>
<!--
            &nbsp; <a class="outer" href="../../aspplus/doc/debuggingoverview.htm">Debugging Overview</a><br>
-->
            &nbsp; <a class="outer" href="../../aspplus/doc/debugcomsdk.htm">The SDK Debugger</a><p>
<!--
            &nbsp; <a class="outer" href="../../aspplus/doc/debugvisualstudio.htm">The Visual Studio 7 Debugger</a><p>
-->

<!--
            <div style="padding:0,0,4,0"><b>Performance</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/perfoverview.htm">Performance Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/perfcounters.htm">Using Performance Counters</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/perftuning.htm">Performance Tuning Tips</a><p>

            <div style="padding:0,0,4,0"><b>ASP to ASP.NET Migration</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/migrationoverview.htm">Migration Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/syntaxandsemantics.htm">Syntax and Semantics</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/languagecompat.htm">Language Compatibility</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/cominterop.htm">COM Interoperability</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/mtstransactions.htm">MTS Transactions</a><p>
-->
            <div style="padding:0,0,4,0"><b>Sample Applications</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/portalapp.htm">A Personalized Portal</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/ecommerceapp.htm">An E-Commerce Storefront</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/classbrowser.htm">A Class Browser Application</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/ibuyspy.htm">IBuySpy.com</a><p>

</div>

</td>
</tr>
</table>
</td>
<td valign="top">
<div class="body">
<!--END HEADER-->

<h4>Forms-based Authentication</h4>

<p>Forms-based authentication is an ASP.NET authentication service that allows applications to 
provide their own login UI and do their own credential verification.  ASP.NET handles 
authenticating users, redirecting unauthenticated users to the login page, and all the 
necessary cookie management.  This sort of authentication is a popular technique, used by many 
web sites.</p>

<p>In order to use forms-based authentication, an application has to be configured to use this 
authentication scheme.  This is done by setting the &lt;authentication&gt; to "Cookie", and 
denying access to anonymous users, as the following example shows (this is in the config.web 
file for the desired application):</p>

<div class="code"><xmp>
<configuration>
    <security>
        <authentication mode="Cookie"/>
        <authorization>
            <deny users="?" /> 
        </authorization>
    </security>
</configuration>
</xmp></div>

<p>Forms-based authentication allows administrators to configure the name of the cookie to 
use, the key with which to encrypt it, and the URL to use for the login page.  The following 
table shows the valid attributes for the &lt;cookie&gt element, which is a subelement of 
&lt;authentication&gt; element as shown below.</p>

<div class="code"><xmp>
<security>
    <authentication mode="Cookie">
        <cookie decryptionkey="autogenerate" loginurl="login.htm" cookie=".ASPXCOOKIEDEMO" />	
    </authentication>
</security>
</xmp></div>

<table class="table2" cellpadding=3 width="95%">
<tr>
	<th width="150"><b>Attribute</b></th>
	<th><b>Description</b></th>
</tr>
<tr>
	<td>decryptionkey</td>
	<td>This specifies the key to use for encrypting/decrypting the cookies for 
		authentication.  If this value is omitted or if "autogenerate" is used, ASP.NET uses a 
		system specific key called from the Crypto APIs.  If "autogenerate" is used, these 
		cookies cannot be used across a web farm, since each key will be machine specific.  If 
		web farm or multi-machine support is desired, administrators need to provide a key, 
		stored in cleartext.</td>
</tr>
<tr>
	<td>loginurl</td>
	<td>The login URL to which unauthenticated users are redirected.  This can be on the same 
		machine, or a remote one.  If it's on a remote machine, both machines need to be using 
		the same value for the decryptionkey attribute.</td>
</tr>
<tr>
	<td>cookie</td>
	<td>The name of the HTTP cookie to use for authentication purposes.  Note that if more 
		than one application wants to use forms-based authentication services on a single 
		machine, they should each configure a unique cookie value.  In order to avoid 
		casing-dependencies in URL's, ASP.NET uses '/' as the Path value when setting 
		authentication cookies, so they're sent back to every application on the site.</td>
</tr>
</table>

<p>After the application has been configured, a login page needs to be provided. The following 
example shows a simple example of a login page.  When the sample is run, it requests the 
default.htm page.  Unauthenticated requests will be redirected to the login page (login.htm) 
which presents a simple forms that prompts for an email address and a password (use 
Username="jdoe@somewhere.com" and Password="password" as credentials).</p>

<p>After validating the credentials, the application calls the following:</p>

<p>
  <script language="JavaScript">
    function doClick(index, id) {
        var numTabs = 3;
        document.all("tab" + id, index).className = "tab";
        for (var i=1; i < numTabs; i++) {
            document.all("tab" + id, (index + i) % numTabs).className = "backtab";
        }
        document.all("code" + id, index).style.display = "";
        for (var j=1; j < numTabs; j++) {
          document.all("code" + id, (index + j) % numTabs).style.display = "none";
        }
    }
  </script>
  <style>
    td.code {
      padding:0,10,0,10;
      border-style:solid;
      border-width:1;
      border-bottom:0;
      border-top:0;
      border-right:0;
      border-color:cccccc;
      background-color:ffffee
    }
    td.tab {
      text-align:center;
      font:8pt verdana;
      width:15%;
      padding:3,3,3,3;
      border-style:solid;
      border-width:1;
      border-right:0;
      border-color:black;
      background-color:eeeeee
    }
    td.backtab {
      text-align:center;
      font: 8pt verdana;
      width:15%;
      padding:3,3,3,3;
      border-style:solid;
      border-width:1;
      border-right:0;
      border-color:black;
      background-color:cccccc
    }
    td.space {
      width:55%;
      font: 8pt verdana;
      padding:0,0,0,0;
      border-style:solid;
      border-bottom:0;
      border-right:0;
      border-width:1;
      border-color:cccccc;
      border-left-color:black;
      background-color:white
    }
  </style>
    <table cellpadding=0 cellspacing=0 width="95%">
      <tr>
        <td class="code" colspan="4">
<pre id="codectrl5" style="display:none">

CookieAuthentication.RedirectFromLoginPage(UserEmail.Value, PersistCookie.Checked);
</pre>
<pre id="codectrl5" style="display:">

CookieAuthentication.RedirectFromLoginPage(UserEmail.Value, PersistCookie.Checked)
</pre>
<pre id="codectrl5" style="display:none">

CookieAuthentication.RedirectFromLoginPage(UserEmail.Value, PersistCookie.Checked);
</pre>
        </td>
      </tr>
      <tr>
        <td class="backtab" id="tabctrl5" onclick="doClick(0, 'ctrl5')">
          <b>C#
        </td>
        <td class="tab" id="tabctrl5" onclick="doClick(1, 'ctrl5')">
          <b>VB
        </td>
        <td class="backtab" id="tabctrl5" onclick="doClick(2, 'ctrl5')">
          <b>JScript
        </td>
        <td class="space">&nbsp;</td>
      </tr>
    </table>
<p>

<p>This redirects the user back to the original URL they requested.  Applications that don't 
wish to perform the redirection can call either <b>CookieAuthentication.GetAuthCookie</b> to 
retrieve the cookie value or <b>CookieAuthentication.SetAuthCookie</b> to attach a properly 
encrypted cookie to the outgoing response.  These techniques can be useful for applications 
that wish to provided login UI embedded into a containing page or that wish to have more 
control over where users are redirected.  Authentication cookies can either be temporary or 
permanent.  Temporary cookies last only the duration of the current browser session (when the 
browser is closed, the cookie is lost).  Permanent cookies are saved by the browser and are 
sent back across browser sessions unless explicitly deleted by the user.</p>

<span>
  
  



<div class="indent">



	<a target="_blank" href="../../aspplus/nowin9x.htm">
	<img style="border-color:black" border=1 src="../../aspplus/images/formsauth.gif"><br>
	</a>
	<div class="caption">Forms-Based/Cookie Authentication</div><br>
	
	
		[<a target="_blank" href="../../aspplus/nowin9x.htm">Run Sample</a>] | 
		[<a target="_blank" href="../../aspplus/samples/security/cookieauth/defaultaspxsource.htm">View Source</a>]
	
	
	</div>


  </span>

<p>The authentication cookie used by forms-authentication consists of a linearized version of 
the <b>System.Web.Security.CookieAuthenticationTicket</b> class.  The information includes the 
user name (but not the password), the version of forms authentication used, the date the 
cookie was issued, and a field for optional application specific data.</p>

<p>Application code can revoke/remove authentication cookies using the 
<b>CookieAuthentication.SignOut</b> method.  This will remove the authentication cookie 
regardless or whether it's a temporary or permanent cookie.</p>

<p>It's also possible to supply the forms-based authentication services with a list of valid 
credentials using configuration.</p>

<div class="code"><xmp>
<security>
    <authentication>
        <credentials passwordformat=b SHA1b  >
            <user name=b Maryb  password=b GASDFSA9823598ASDBADb />
            <user name=b Johnb  password=b ZASDFADSFASD23483142b />	
        </credentials>
    </authentication>
</security>
</xmp></div>

<p>The application can then call <b>CookieAuthenticationManager.Authenticate</b>, supplying 
the username and password, and ASP.NET will perform the credential verification.  Credentials can 
be stored in cleartext, or as SHA1 or MD5 hashes, according to the following values of the 
passwordformat attribute.</p>

<table class="table2" cellpadding=3>
	<tr>
		<th width="150">Hash Type</th>
		<th>Description</th>
	</tr>
	<tr>
		<td>Clear</td>
		<td>Passwords are stored in cleartext</td>
	</tr>
	<tr>
		<td>SHA1</td>
		<td>Passwords are stored as SHA1 digests</td>
	</tr>
	<tr>
		<td>MD5</td>
		<td>Passwords are stored as MD5 digests</td>
	</tr>
</table>

<!--END FOOTER-->
<p>
<hr>
<p>
</div>
</td>
</tr>
</table>
</BODY>
</html>
<!--END FOOTER-->