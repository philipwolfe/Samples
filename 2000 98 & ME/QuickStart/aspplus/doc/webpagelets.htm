


<!--BEGIN HEADER-->
<html>
<head>
<link rel="stylesheet" href="../../include/qsstyle.css">
</head>
<body topmargin="0" leftmargin="0" marginwidth="0" marginheight="0" >

<table class="outer" cellpadding=0 cellspacing=0>
<tr>
<td class="toc" valign="top" width="210">
  <table>
<tr>
<td nowrap style="padding-right:15">

<div class="toc" style="font-size:8pt;color:darkred;">

            <div style="padding:0,0,4,0"><b>Getting Started</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/quickstart.htm">Introduction</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/whatisaspx.htm">What is ASP.NET?</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/langsupport.htm">Language Support</a><p>

            <div style="padding:0,0,4,0"><b>ASP.NET Web Forms</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/webformsintro.htm">Introducing Web Forms</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webserverctrls.htm">Working with Server Controls</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webtemplates.htm">Applying Styles to Controls</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webvalidation.htm">Server Control Form Validation</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webpagelets.htm">Web Forms User Controls</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webdatabinding.htm">Databinding Server Controls</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webdataaccess.htm">Server-Side Data Access</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webdatalist.htm">Data Access and Customization</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/businessobjs.htm">Working with Business Objects</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webctrlauthoring.htm">Authoring Custom Controls</a><br>
<!--            &nbsp; <a class="outer" href="../../aspplus/doc/webformsandvs7.htm">Visual Studio 7.0 & Web Forms</a><br> -->
            &nbsp; <a class="outer" href="../../aspplus/doc/webcontrolsref.htm">Web Forms Controls Reference</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webformssyntaxref.htm">Web Forms Syntax Reference</a><p>

            <div style="padding:0,0,4,0"><b>ASP.NET Web Services</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/webservicesintro.htm">Introducing Web Services</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/writingservices.htm">Writing a Simple Web Service</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/webservicetypes.htm">Web Service Type Marshalling</a><br>
<!--            &nbsp; <a class="outer" href="../../aspplus/doc/discoverservices.htm">Making Services Discoverable</a><br> -->
            &nbsp; <a class="outer" href="../../aspplus/doc/servicesanddata.htm">Using Data in Web Services</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/servicesandobjs.htm">Using Objects and Intrinsics</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/htmlscraping.htm">HTML Pattern Matching</a><p>

            <div style="padding:0,0,4,0"><b>ASP.NET Web Applications</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/applications.htm">Application Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/globalasax.htm">Using the Global.asax File</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/stateoverview.htm">Managing Application State</a><br>
<!--            &nbsp; <a class="outer" href="../../aspplus/doc/httpmodules.htm">Handling HttpModule Events</a><br> -->
            &nbsp; <a class="outer" href="../../aspplus/doc/httphandlers.htm">HttpHandlers and Factories</a><p>

<!--
            <div style="padding:0,0,4,0"><b>State Management</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/stateoverview.htm">State Management Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/pageviewstate.htm">Using Page-local View State</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/sessionappstate.htm">Session and Application State</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/usingcookies.htm">Using Client-side Cookies</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/choosingstate.htm">Choosing a Strategy</a><p>
-->
            <div style="padding:0,0,4,0"><b>Cache Services</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/cachingoverview.htm">Caching Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/outputcaching.htm">Page Output Caching</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/datacaching.htm">Page Data Caching</a><p>

            <div style="padding:0,0,4,0"><b>Configuration</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/configoverview.htm">Configuration Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/configformat.htm">Configuration File Format</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/configretrieve.htm">Retrieving Configuration</a><p>

            <div style="padding:0,0,4,0"><b>Deployment</b><br></div>
<!--            &nbsp; <a class="outer" href="../../aspplus/doc/adminoverview.htm">Administration Overview</a><br> -->
            &nbsp; <a class="outer" href="../../aspplus/doc/deployment.htm">Deploying ASP.NET Applications</a><p>

            <div style="padding:0,0,4,0"><b>Security</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/securityoverview.htm">Security Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/authandauth.htm">Authentication & Authorization</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/windowsauth.htm">Windows-based Authentication</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/formsauth.htm">Forms-based Authentication</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/authorization.htm">Authorizing Users and Roles</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/impersonation.htm">User Account Impersonation</a><p>

            <div style="padding:0,0,4,0"><b>Localization</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/internationalization.htm">Internationalization Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/cultureencoding.htm">Setting Culture and Encoding</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/localizingapps.htm">Localizing ASP.NET Applications</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/resourcefiles.htm">Working with Resource Files</a><p>

            <div style="padding:0,0,4,0"><b>Tracing</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/tracingoverview.htm">Tracing Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/tracelogpage.htm">Trace Logging to Page Output</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/tracelogapp.htm">Application-level Trace Logging</a><p>

            <div style="padding:0,0,4,0"><b>Debugging</b><br></div>
<!--
            &nbsp; <a class="outer" href="../../aspplus/doc/debuggingoverview.htm">Debugging Overview</a><br>
-->
            &nbsp; <a class="outer" href="../../aspplus/doc/debugcomsdk.htm">The SDK Debugger</a><p>
<!--
            &nbsp; <a class="outer" href="../../aspplus/doc/debugvisualstudio.htm">The Visual Studio 7 Debugger</a><p>
-->

<!--
            <div style="padding:0,0,4,0"><b>Performance</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/perfoverview.htm">Performance Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/perfcounters.htm">Using Performance Counters</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/perftuning.htm">Performance Tuning Tips</a><p>

            <div style="padding:0,0,4,0"><b>ASP to ASP.NET Migration</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/migrationoverview.htm">Migration Overview</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/syntaxandsemantics.htm">Syntax and Semantics</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/languagecompat.htm">Language Compatibility</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/cominterop.htm">COM Interoperability</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/mtstransactions.htm">MTS Transactions</a><p>
-->
            <div style="padding:0,0,4,0"><b>Sample Applications</b><br></div>
            &nbsp; <a class="outer" href="../../aspplus/doc/portalapp.htm">A Personalized Portal</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/ecommerceapp.htm">An E-Commerce Storefront</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/classbrowser.htm">A Class Browser Application</a><br>
            &nbsp; <a class="outer" href="../../aspplus/doc/ibuyspy.htm">IBuySpy.com</a><p>

</div>

</td>
</tr>
</table>
</td>
<td valign="top">
<div class="body">
<!--END HEADER-->

<h4>Web Forms User Controls</h4>
<p>


<div class="indent" style="font-family:Verdana; font-size:8pt;">
    <b> <img align="middle" src="../../images/bullet.gif">&nbsp;&nbsp;</b><a class="toc2" href="#intro">Introduction to User Controls</a><br>
    <b> <img align="middle" src="../../images/bullet.gif">&nbsp;&nbsp;</b><a class="toc2" href="#properties">Exposing User Control Properties</a><br>
    <b> <img align="middle" src="../../images/bullet.gif">&nbsp;&nbsp;</b><a class="toc2" href="#events">Encapsulating Events in a User Control</a><br>
    <b> <img align="middle" src="../../images/bullet.gif">&nbsp;&nbsp;</b><a class="toc2" href="#program">Creating User Controls Programmatically</a><br>
</div>

<p>
<hr>


<!--BEGIN SECTION-->
<a name="intro">
<span class="subhead">Introduction to User Controls</span>
<p>
In addition to the built-in server controls provided by ASP.NET, you can easily define your own controls using the same programming 
techniques you've already learned for writing Web Forms.  In fact, with just a few modifications, almost any Web Form
can be re-used in another page as a server control (notice that the base System.Web.UI.Page class inherits directly from 
System.Web.UI.Control).  A Web Form used as a server control is named a <b>User Control</b>, 
for short.  As a matter of convention, we use the <b>.ascx</b> extension to indicate such controls.  This ensures that the User Control's file cannot
be executed as a standalone Web Form (we'll see a little later how there are a few, albiet important, differences between 
a User Control and a Web Form).  User Controls are included into another Web Form using a <b>Register</b>  directive:

<div class="code"><pre>
&lt;%@ Register TagPrefix="Acme" TagName="Message" Src="pagelet1.ascx" %&gt;
</pre></div>

<p>
The TagPrefix determines a unique namespace for the User Control (so that multiple User Controls with the same name can be differentiated from 
each other).  The TagName is the unique name for the User Control (you can choose any name).  The Src attribute is the virtual path to the 
User Control, for example "MyPagelet.ascx" or "/MyApp/Include/MyPagelet.ascx".  After registering the User Control, you may place the User Control 
tag in the Web Form just as you would an ordinary server control (including the runat="server" attribute):
<p>

<div class="code"><pre>
&lt;Acme:Message runat="server"/&gt;
</pre></div>

<p>
The following example shows a User Control imported into another Web Form. Note that the User Control in this case is just a simple static file:
<p>

<span>
  
  
  



<div class="indent">



	<a target="_blank" href="../../aspplus/nowin9x.htm">
	<img style="border-color:black" border=1 src="../../aspplus/images/pagelet1.gif"><br>
	</a>
	<div class="caption">Pagelet1.htm</div><br>
	
	
		[<a target="_blank" href="../../aspplus/nowin9x.htm">Run Sample</a>] | 
		[<a target="_blank" href="../../aspplus/samples/webforms/pagelets/pagelet1aspxsource.htm">View Source</a>]
	
	
	</div>


  </span>


<!--BEGIN SECTION-->
<br>
<a name="properties">
<br>
<span class="subhead">Exposing User Control Properties</span>
<p>

When we treat a Web Form as a control, the public fields and methods of that Web Form are promoted to public properties (i.e. tag 
attributes) and methods of the control as well.  The following example shows an extension of the previous User Control example that adds 
two public String fields.  Notice that these fields can be set either declaratively or programmatically in the containing page.
<p>

<span>
  
  
  



<div class="indent">



	<a target="_blank" href="../../aspplus/nowin9x.htm">
	<img style="border-color:black" border=1 src="../../aspplus/images/pagelet2.gif"><br>
	</a>
	<div class="caption">Pagelet2.htm</div><br>
	
	
		[<a target="_blank" href="../../aspplus/nowin9x.htm">Run Sample</a>] | 
		[<a target="_blank" href="../../aspplus/samples/webforms/pagelets/pagelet2aspxsource.htm">View Source</a>]
	
	
	</div>


  </span>

<p>
In addition to promoting public fields to control properties, the property syntax may be used.  Property syntax has the advantage 
of being able to execute code when properties are set or retrieved.  In this next example, we've implemented an Address User Control that wraps the "Text"
properties of TextBox controls within it.  The benefit of doing this is that we inherit the automatic state management of the TextBox control 
for free!
<p>
Notice that we've placed two Address User Controls on the containing Web Form, and differentiated between them by setting the 
"caption" property to "Billing Address" and "Shipping Address" respectively.  The real power of User Controls is in this type of reusability.
<p>

<span>
  
  
  



<div class="indent">



	<a target="_blank" href="../../aspplus/nowin9x.htm">
	<img style="border-color:black" border=1 src="../../aspplus/images/pagelet3.gif"><br>
	</a>
	<div class="caption">Pagelet3.htm</div><br>
	
	
		[<a target="_blank" href="../../aspplus/nowin9x.htm">Run Sample</a>] | 
		[<a target="_blank" href="../../aspplus/samples/webforms/pagelets/pagelet3aspxsource.htm">View Source</a>]
	
	
	</div>


  </span>

<p>
Another useful User Control is a Login control for collecting usernames and passwords:
<p>

<span>
  
  
  



<div class="indent">



	<a target="_blank" href="../../aspplus/nowin9x.htm">
	<img style="border-color:black" border=1 src="../../aspplus/images/pagelet4.gif"><br>
	</a>
	<div class="caption">Pagelet4.htm</div><br>
	
	
		[<a target="_blank" href="../../aspplus/nowin9x.htm">Run Sample</a>] | 
		[<a target="_blank" href="../../aspplus/samples/webforms/pagelets/pagelet4aspxsource.htm">View Source</a>]
	
	
	</div>


  </span>

<p>
Here we've added form validation controls to the Login User Control.
<p>

<span>
  
  
  



<div class="indent">



	<a target="_blank" href="../../aspplus/nowin9x.htm">
	<img style="border-color:black" border=1 src="../../aspplus/images/pagelet5.gif"><br>
	</a>
	<div class="caption">Pagelet5.htm</div><br>
	
	
		[<a target="_blank" href="../../aspplus/nowin9x.htm">Run Sample</a>] | 
		[<a target="_blank" href="../../aspplus/samples/webforms/pagelets/pagelet5aspxsource.htm">View Source</a>]
	
	
	</div>


  </span>

<!--BEGIN SECTION-->
<br>
<a name="events">
<br>
<span class="subhead">Encapsulating Events in a User Control</span>
<p>

User Controls participate in the complete execution lifecycle of the request, much the way ordinary server controls do.  This means that
a User Control can handle its own events, encapsulating some of the page logic from the containing Web Form.  In this next example,
we've implemented a product listing User Control that internally handles its own post-backs.  One thing to notice is that the User Control itself
has no wrapping &lt;form runat="server"&gt; control.  Because only one form control may be present on a page (ASP.NET does not 
allow nested server forms), we leave it to the containing Web Form to define this for us.
<p>

<span>
  
  
  



<div class="indent">



	<a target="_blank" href="../../aspplus/nowin9x.htm">
	<img style="border-color:black" border=1 src="../../aspplus/images/pagelet6.gif"><br>
	</a>
	<div class="caption">Pagelet6.htm</div><br>
	
	
		[<a target="_blank" href="../../aspplus/nowin9x.htm">Run Sample</a>] | 
		[<a target="_blank" href="../../aspplus/samples/webforms/pagelets/pagelet6aspxsource.htm">View Source</a>]
	
	
	</div>


  </span>


<!--BEGIN SECTION-->
<br>
<a name="program">
<br>
<span class="subhead">Creating User Controls Programmatically</span>
<p>

Just as ordinary server controls can be created programmatically, so too can User Controls.  We use the Page's <b>LoadControl</b> method to
load the User Control, passing the virtual path to the User Control's source file: <p>

<p>
  <script language="JavaScript">
    function doClick(index, id) {
        var numTabs = 3;
        document.all("tab" + id, index).className = "tab";
        for (var i=1; i < numTabs; i++) {
            document.all("tab" + id, (index + i) % numTabs).className = "backtab";
        }
        document.all("code" + id, index).style.display = "";
        for (var j=1; j < numTabs; j++) {
          document.all("code" + id, (index + j) % numTabs).style.display = "none";
        }
    }
  </script>
  <style>
    td.code {
      padding:0,10,0,10;
      border-style:solid;
      border-width:1;
      border-bottom:0;
      border-top:0;
      border-right:0;
      border-color:cccccc;
      background-color:ffffee
    }
    td.tab {
      text-align:center;
      font:8pt verdana;
      width:15%;
      padding:3,3,3,3;
      border-style:solid;
      border-width:1;
      border-right:0;
      border-color:black;
      background-color:eeeeee
    }
    td.backtab {
      text-align:center;
      font: 8pt verdana;
      width:15%;
      padding:3,3,3,3;
      border-style:solid;
      border-width:1;
      border-right:0;
      border-color:black;
      background-color:cccccc
    }
    td.space {
      width:55%;
      font: 8pt verdana;
      padding:0,0,0,0;
      border-style:solid;
      border-bottom:0;
      border-right:0;
      border-width:1;
      border-color:cccccc;
      border-left-color:black;
      background-color:white
    }
  </style>
    <table cellpadding=0 cellspacing=0 width="95%">
      <tr>
        <td class="code" colspan="4">
<pre id="codectrl20" style="display:none">

UserControl c1 = LoadControl("pagelet7.ascx");
((pagelet7_ascx)c1).Category = "business";
Page.Controls.Add(c1);
</pre>
<pre id="codectrl20" style="display:">

Dim c1 As UserControl = LoadControl("pagelet7.ascx")
CType(c1, (pagelet7_ascx)).Category = "business"
Page.Controls.Add(c1)
</pre>
<pre id="codectrl20" style="display:none">

var c1:UserControl = LoadControl("pagelet7.ascx");
(pagelet7_ascx(c1)).Category = "business";
Page.Controls.Add(c1);
</pre>
        </td>
      </tr>
      <tr>
        <td class="backtab" id="tabctrl20" onclick="doClick(0, 'ctrl20')">
          <b>C#
        </td>
        <td class="tab" id="tabctrl20" onclick="doClick(1, 'ctrl20')">
          <b>VB
        </td>
        <td class="backtab" id="tabctrl20" onclick="doClick(2, 'ctrl20')">
          <b>JScript
        </td>
        <td class="space">&nbsp;</td>
      </tr>
    </table>
<p>

The type of the User Control is determined by the ASP.NET runtime, following the convention <i>filename</i>_<i>extension</i>.  
For example, a User Control saved as filename "pagelet7.ascx" is assigned the strong type "pagelet7_ascx".  Because the LoadControl 
method returns a type of System.Web.UI.UserControl, we need to cast to the appropriate strong type in order to set individual properties
of the User Control control.  Finally, the User Control is added to the base Page's Controls collection.
<p>

<span>
  
  
  



<div class="indent">



	<a target="_blank" href="../../aspplus/nowin9x.htm">
	<img style="border-color:black" border=1 src="../../aspplus/images/pagelet7.gif"><br>
	</a>
	<div class="caption">Pagelet7.htm</div><br>
	
	
		[<a target="_blank" href="../../aspplus/nowin9x.htm">Run Sample</a>] | 
		[<a target="_blank" href="../../aspplus/samples/webforms/pagelets/pagelet7aspxsource.htm">View Source</a>]
	
	
	</div>


  </span>

<p>
<b>Important: </b>  The strong type for a User Control is available to the containing Web Form only if a Register directive is included for
the User Control (even if there are no User Control tags actually declared).

<!--BEGIN SECTION-->
<a name="endofsection">

<h4>Section Summary</h4>
<ol>
<li>User Controls allow developers to easily define custom controls using the same programming techniques for writing Web Forms.
<li>As a matter of convention, we use the <b>.ascx</b> extension to indicate such controls.  This ensures that the User Control's file cannot
be executed as a standalone Web Form.
<li>User Controls are included into another Web Form using a <b>Register</b> directive, which specifies a TagPrefix, TagName, and Src location.
<li>After registering the User Control, a User Control tag may be placed in a Web Form as an ordinary server control (including the runat="server" attribute).
<li>The public fields, properties and methods of a User Control are promoted to public properties (i.e. tag attributes) and methods of the 
control in the containing Web Form.
<li>User Controls participate in the complete execution lifecycle of every request and can handle their own events, encapsulating some of the 
page logic from the containing Web Form.
<li>User Controls should not contain any form controls, but should instead rely on their containing Web Form to include one if necessary.
<li>User Controls may be created programmatically using the LoadControl method of the System.Web.UI.Page class.  The type of the User Control is 
determined by the ASP.NET runtime, following the convention <i>filename</i>_<i>extension</i>. 
<li>The strong type for a User Control is available to the containing Web Form only if a Register directive is included for
the User Control (even if there are no User Control tags actually declared).
</ol>
<p>

<!--END FOOTER-->
<p>
<hr>
<p>
</div>
</td>
</tr>
</table>
</BODY>
</html>
<!--END FOOTER-->