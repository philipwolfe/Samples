



    <link rel="stylesheet" href="../../../../util/style.css">

    <form name="Form" method="post" action="srcview.htm?path=/QuickStart/aspplus/samples/portal/portal.src&file=restricted/customize.htm" id="Form">
<input type="hidden" name="__VIEWSTATE" value="YTB6MTQ3MzAyNjM4MF9hMHpfaHo1ejN4X2Ewel9oejV6MHhfYTB6aHppbm5lcmh0bWxfcmVzdHJpY3RlZC9jdXN0b21pXHplLmFzcFx4eF9feHhfeHhfeF9feA==7a180063" />


        <div class="SampleHeader" style="width:100%">
            <div class="SampleTitle">
                <span id="Title">restricted/customize.htm</span>
            </div>
            <table id="SourceTable" style="font: 8pt Verdana">
    <tr>
        <td style="padding-right:10;"><b><nobr>Unrestricted Pages</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/defaultaspxsource.htm'>default.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/loginaspxsource.htm'>login.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/useraspxsource.htm'>user.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/congratsaspxsource.htm'>congrats.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/constraspxsource.htm'>constr.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/configwebsource.htm'>config.web</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Restricted Pages</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/restricted/customizeaspxsource.htm'>restricted/customize.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/restricted/deletepageaspxsource.htm'>restricted/deletepage.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/restricted/layoutaspxsource.htm'>restricted/layout.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/restricted/optionsaspxsource.htm'>restricted/options.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/restricted/configwebsource.htm'>restricted/config.web</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Personalization Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/personalization/personalizationcssource.htm'>personalization/Personalization.cs</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/personalization/portalmodulecssource.htm'>personalization/PortalModule.cs</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/personalization/makesamplebatsource.htm'>personalization/makesample.bat</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Stored Procedures</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/data/portalsqlsource.htm'>data/portal.sql</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Login Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/login/loginascxsource.htm'>modules/login/login.ascx</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>BookOfTheDay Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/bookoftheday/bookofthedayascxsource.htm'>modules/bookoftheday/bookoftheday.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/bookoftheday/bookoftheday_demoaspxsource.htm'>modules/bookoftheday/bookoftheday_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>SiteDirectory Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/sitedirectory/sitedirectoryascxsource.htm'>modules/sitedirectory/sitedirectory.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/sitedirectory/sitedirectory_demoaspxsource.htm'>modules/sitedirectory/sitedirectory_demo.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/sitedirectory/sitedirectory_editaspxsource.htm'>modules/sitedirectory/sitedirectory_edit.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Welcome Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/welcome/welcomeascxsource.htm'>modules/welcome/welcome.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/welcome/welcome_demoaspxsource.htm'>modules/welcome/welcome_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>LocalNews Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/static/localnewsascxsource.htm'>modules/static/localnews.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/static/localnews_demoaspxsource.htm'>modules/static/localnews_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>WorldNews Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/static/worldnewsascxsource.htm'>modules/static/worldnews.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/static/worldnews_demoaspxsource.htm'>modules/static/worldnews_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Weather Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/static/weatherascxsource.htm'>modules/static/weather.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/static/weather_demoaspxsource.htm'>modules/static/weather_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>FavoriteLinks Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/favoritelinks/favoritelinksascxsource.htm'>modules/favoritelinks/favoritelinks.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/favoritelinks/favoritelinks_demoaspxsource.htm'>modules/favoritelinks/favoritelinks_demo.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/favoritelinks/favoritelinks_editaspxsource.htm'>modules/favoritelinks/favoritelinks_edit.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/favoritelinks/favoritelinksleftascxsource.htm'>modules/favoritelinks/favoritelinksleft.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/favoritelinks/favoritelinksleft_demoaspxsource.htm'>modules/favoritelinks/favoritelinksleft_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Include Files</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/include/editmoduleheaderascxsource.htm'>include/editmoduleheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/editmodulefooterascxsource.htm'>include/editmodulefooter.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/leftmoduleheaderascxsource.htm'>include/leftmoduleheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/leftmodulefooterascxsource.htm'>include/leftmodulefooter.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/pageheaderascxsource.htm'>include/pageheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/leftmoduleheaderascxsource.htm'>include/leftmoduleheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/leftmodulefooterascxsource.htm'>include/leftmodulefooter.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/rightmoduleheaderascxsource.htm'>include/rightmoduleheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/rightmodulefooterascxsource.htm'>include/rightmodulefooter.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/pagefooterascxsource.htm'>include/pagefooter.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/pagesubheaderascxsource.htm'>include/pagesubheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/pagesubfooterascxsource.htm'>include/pagesubfooter.ascx</a> &nbsp;&nbsp</td>
    </tr>
</table>

        </div>

        <xmp><%@ Page Inherits="PortalModulePage" Description="Customize/Add Module Page" %>
<%@ Register TagName="PageHeader" TagPrefix="PageHeader" Src="../../../../aspplus/samples/portal/include/pageheader.ascx" %>

<%@ Import Namespace="System.Web.UI.HtmlControls" %>
<%@ Import Namespace="System.Collections" %>
<%@ Import Namespace="System.Data" %> 
<%@ Import Namespace="System.Data.SQL" %>

<html>
<head>

    <script language="C#" runat="server">

        public int pageIndex;
        public String pageName;
        public ArrayList Source;
        public String [] pageList;

        protected void Page_Load(Object sender, EventArgs e) 
        { 
             SQLDataSetCommand myAdapter = new SQLDataSetCommand(); 

            String dsn = (String) ((Hashtable) Context.GetConfig("dsnstore"))["portaldb"];
            myAdapter.SelectCommand.ActiveConnection = new SQLConnection(dsn) ; 
            myAdapter.SelectCommand.CommandText =  "GetPublicModules";
            myAdapter.SelectCommand.CommandType = CommandType.StoredProcedure;
            DataSet myDataSet = new DataSet();
            myAdapter.FillDataSet(myDataSet,"Results");

            if (Request.Cookies["_PageIndex"] != null) {
                pageIndex = Int32.Parse(Request.Cookies["_PageIndex"].Value);
            }
            else 
            {
                pageIndex = 0; 
            }

            String pageNames = UserState["PageNames"];

            pageList = pageNames.Split(new char[] { ';' });

            pageName = pageList[pageIndex];

            Hashtable moduleHash = new Hashtable();

            String leftModules = UserState["PageModules_" + pageIndex + "L"];
            if (leftModules != null) 
            {
                String [] leftModuleList = leftModules.Split(new char[] {';'});
                for (int i=0;i<leftModuleList.Length;i++) 
                   moduleHash[leftModuleList[i]] = true;
            }

            String rightModules = UserState["PageModules_" + pageIndex + "R"];
            if (rightModules != null) 
            {
                String [] rightModuleList = rightModules.Split(new char[] {';'});
                for (int i=0;i<rightModuleList.Length;i++) 
                   moduleHash[rightModuleList[i]] = true;
            }

            RowsCollection rows = myDataSet.Tables[0].Rows;
            DataColumn [] columns  = myDataSet.Tables[0].Columns.All;

            Source = new ArrayList();

            for (int i=0; i<rows.Count; i++) {

               Hashtable propertyBag = new Hashtable();

               for (int j=0; j<columns.Length;j++) {
                  Object value = myDataSet.Tables[0].Rows[i][columns[j]];
                  propertyBag[columns[j].ToString()] = (value== null) ? "" : value.ToString();
               }

               if (moduleHash[propertyBag["Source"]] != null)
                   propertyBag["IsChecked"] = true;
               else
                   propertyBag["IsChecked"] = false;

               Source.Add (propertyBag);
            }

            myDataGrid.DataSource = Source;
            if(! IsPostBack)
                DataBind();
        }
  
    public void Submit_Click(Object sender, EventArgs evt)
    {
        String sLeft = "";
        String sRight = "";
        for (int i=0; i<myDataGrid.Items.Count; i++)
        {
              if( ((HtmlInputCheckBox) myDataGrid.Items[i].FindControl("mSelected")).Checked )
                 
                  if (String.Compare (((Label) myDataGrid.Items[i].FindControl("mType")).Text ,"L") == 0)
                      sLeft += ((Hashtable)Source[i])["Source"] + ";";
                  else
                      sRight += ((Hashtable)Source[i])["Source"] + ";";
            }

            if (Request.Cookies["_PageIndex"] == null)
                pageIndex = 0;

            char[] semi = {';'};
            if (String.Compare(UserState["UserId"],"ANONYMOUS") != 0) 
            {
                UserState["PageModules_" + pageIndex + "L"] = sLeft.TrimEnd(semi);
                UserState["PageModules_" + pageIndex + "R"] = sRight.TrimEnd(semi);
            }

            pageList[pageIndex] = txtPageName.Value; 
            String s = "";
            for (int i=0; i<pageList.Length; i++)
                s += pageList[i] + ";";

            UserState["PageNames"] = s.TrimEnd(semi); 

            Response.Redirect("/quickstart/aspplus/samples/portal/default.htm");  
    }

 
    </script>

</head>

<body bgcolor="ffffff" style="margin:0,0,0,0">
<form  runat="server" >

<PageHeader:PageHeader runat="server"/>

<table border=0 width="100%" cellspacing=0 cellpadding=0 style="padding:0,0,0,0">
    <tr align=left>
      <td bgcolor="<%# UserState["HeadColor"]%>" height="35" style="padding:0,0,0,15;border-color:black;border-style:solid; border-width:1;border-right:0;border-left:0;border-bottom:0"><font face=Arial color="white">&nbsp;<b>Personalize This Page</b></font>&nbsp;</td>
    </tr>
    <tr>
      <td width="100%" valign="top">
        <table border=0 width="100%" cellspacing=0 cellpadding=0>
          <tr>
            <td>
              <!--BEGIN MODULE-->
                <table width="100%" cellpadding=5 cellspacing=0>
                  <tr>
                    <td align="left" height="75" bgcolor="<%# UserState["SubheadColor"]%>" style="padding:15,15,15,20;border-color:black;border-style:solid; border-width:1;border-right:0;border-left:0">
                     <font face="Arial"><b>Page Name</b></font> &nbsp;&nbsp;<input type="text" id="txtPageName" value=<%# pageName %> size="35" runat="server"/>
                    </td>
                    <td align="right" bgcolor="<%# UserState["SubheadColor"]%>" style="padding:15,15,15,15;border-color:black;border-style:solid;border-width:1;border-left:0;border-right:0">
                        <input type="submit" value="Submit Changes" OnServerClick="Submit_Click" runat="server"/>
                    </td>
                  </tr>
                  <tr bgcolor="ffffff">
                    <td align="left" colspan="2" width="50%" height="25" style="padding:15,15,15,15;border-color:black;border-style:solid;                            border-top:0;border-width:1;border-right:0;border-left:0">
                      <asp:DataGrid id="myDataGrid" runat="server" AutoGenerateColumns="False" showfooter="false" 
                        gridlines=none borderstyle=none borderwidth=0>
                        <property name="columns">
                          <asp:TemplateColumn>
                            <template name="ItemTemplate">
                              <input type="checkbox" Checked=<%#((Hashtable)Container.DataItem)["IsChecked"] %> id="mSelected" runat="server" >
                              <a target="_new" style="color:blue;font:10pt verdana, arial" HRef=<%#((Hashtable) Container.DataItem)["DemoSource"] %>
                              InnerHTML=<%# ((Hashtable) Container.DataItem)["Name"] %> runat="server"/>  
                              <font size="-2">&nbsp;( <asp:label text=<%# ((Hashtable) Container.DataItem)["Type"] %> id="mType" runat="server"/> ) </font><br>
                              <asp:label style="color:black;font:8pt verdana, arial" text=<%# ((Hashtable) Container.DataItem)["Description"] %> runat="server"/><p> 
                            </template>
                          </asp:TemplateColumn>
                        </property>
                      </asp:DataGrid>
                    </td>
                  </tr>
                  <tr bgcolor="<%# UserState["SubheadColor"]%>">
                    <td align="left" height="55" style="border-color:black;border-style:solid;                          border-width:1;border-top:0;border-right:0;border-left:0"> &nbsp;
                    </td>
                    <td align="right"                    style="padding:15,15,15,15;border-color:black;border-style:solid;border-width:1;border-top:0;border-right:0;border-left:0">
                      <input type="submit" value="Submit Changes" OnServerClick="Submit_Click" runat="server"/>
                    </td>
                  </tr>
                </table>
                <!--END MODULE-->
              </td>
            </tr>
          </table>
        </td>
    </tr>
</table>

</form>
</body>
</html>
</xmp>
        <span id="ErrorMessage" style="color:red"></span>

    </form>
