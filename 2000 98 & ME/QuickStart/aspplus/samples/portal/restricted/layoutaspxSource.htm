



    <link rel="stylesheet" href="../../../../util/style.css">

    <form name="Form" method="post" action="srcview.htm?path=/QuickStart/aspplus/samples/portal/portal.src&file=restricted/layout.htm" id="Form">
<input type="hidden" name="__VIEWSTATE" value="YTB6MTQ3MzAyNjM4MF9hMHpfaHo1ejN4X2Ewel9oejV6MHhfYTB6aHppbm5lcmh0bWxfcmVzdHJpY3RlZC9sYXlvdXQuYXNwXHh4X194eF94eF94X194588c0be2" />


        <div class="SampleHeader" style="width:100%">
            <div class="SampleTitle">
                <span id="Title">restricted/layout.htm</span>
            </div>
            <table id="SourceTable" style="font: 8pt Verdana">
    <tr>
        <td style="padding-right:10;"><b><nobr>Unrestricted Pages</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/defaultaspxsource.htm'>default.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/loginaspxsource.htm'>login.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/useraspxsource.htm'>user.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/congratsaspxsource.htm'>congrats.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/constraspxsource.htm'>constr.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/configwebsource.htm'>config.web</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Restricted Pages</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/restricted/customizeaspxsource.htm'>restricted/customize.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/restricted/deletepageaspxsource.htm'>restricted/deletepage.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/restricted/layoutaspxsource.htm'>restricted/layout.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/restricted/optionsaspxsource.htm'>restricted/options.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/restricted/configwebsource.htm'>restricted/config.web</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Personalization Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/personalization/personalizationcssource.htm'>personalization/Personalization.cs</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/personalization/portalmodulecssource.htm'>personalization/PortalModule.cs</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/personalization/makesamplebatsource.htm'>personalization/makesample.bat</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Stored Procedures</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/data/portalsqlsource.htm'>data/portal.sql</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Login Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/login/loginascxsource.htm'>modules/login/login.ascx</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>BookOfTheDay Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/bookoftheday/bookofthedayascxsource.htm'>modules/bookoftheday/bookoftheday.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/bookoftheday/bookoftheday_demoaspxsource.htm'>modules/bookoftheday/bookoftheday_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>SiteDirectory Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/sitedirectory/sitedirectoryascxsource.htm'>modules/sitedirectory/sitedirectory.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/sitedirectory/sitedirectory_demoaspxsource.htm'>modules/sitedirectory/sitedirectory_demo.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/sitedirectory/sitedirectory_editaspxsource.htm'>modules/sitedirectory/sitedirectory_edit.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Welcome Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/welcome/welcomeascxsource.htm'>modules/welcome/welcome.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/welcome/welcome_demoaspxsource.htm'>modules/welcome/welcome_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>LocalNews Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/static/localnewsascxsource.htm'>modules/static/localnews.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/static/localnews_demoaspxsource.htm'>modules/static/localnews_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>WorldNews Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/static/worldnewsascxsource.htm'>modules/static/worldnews.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/static/worldnews_demoaspxsource.htm'>modules/static/worldnews_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Weather Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/static/weatherascxsource.htm'>modules/static/weather.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/static/weather_demoaspxsource.htm'>modules/static/weather_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>FavoriteLinks Module</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/modules/favoritelinks/favoritelinksascxsource.htm'>modules/favoritelinks/favoritelinks.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/favoritelinks/favoritelinks_demoaspxsource.htm'>modules/favoritelinks/favoritelinks_demo.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/favoritelinks/favoritelinks_editaspxsource.htm'>modules/favoritelinks/favoritelinks_edit.htm</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/favoritelinks/favoritelinksleftascxsource.htm'>modules/favoritelinks/favoritelinksleft.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/modules/favoritelinks/favoritelinksleft_demoaspxsource.htm'>modules/favoritelinks/favoritelinksleft_demo.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b><nobr>Include Files</nobr>: </b></td>
        <td><a href='../../../../aspplus/samples/portal/include/editmoduleheaderascxsource.htm'>include/editmoduleheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/editmodulefooterascxsource.htm'>include/editmodulefooter.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/leftmoduleheaderascxsource.htm'>include/leftmoduleheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/leftmodulefooterascxsource.htm'>include/leftmodulefooter.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/pageheaderascxsource.htm'>include/pageheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/leftmoduleheaderascxsource.htm'>include/leftmoduleheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/leftmodulefooterascxsource.htm'>include/leftmodulefooter.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/rightmoduleheaderascxsource.htm'>include/rightmoduleheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/rightmodulefooterascxsource.htm'>include/rightmodulefooter.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/pagefooterascxsource.htm'>include/pagefooter.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/pagesubheaderascxsource.htm'>include/pagesubheader.ascx</a> &nbsp;&nbsp<a href='../../../../aspplus/samples/portal/include/pagesubfooterascxsource.htm'>include/pagesubfooter.ascx</a> &nbsp;&nbsp</td>
    </tr>
</table>

        </div>

        <xmp><%@ Page Inherits="PortalModulePage" Description="Layout Page" %>

<%@ Register TagName="PageHeader" TagPrefix="PageHeader" Src="../../../../aspplus/samples/portal/include/pageheader.ascx" %>

<%@ Import Namespace="System.Collections" %>
<%@ Import Namespace="System.Data" %> 
<%@ Import Namespace="System.Data.SQL" %>

<html>
<head>

<script Language="Javascript">

function doRemoveLinks() {
    var options = myForm.mySelect.options;
    for (i=0; i < options.length; i++) {
        if (options[i].selected)
        {
            options[i] = null; i--;
        }
    }
}

function doMoveUp() {

    var options = myForm.mySelect.options

    for (i=0; i < options.length; i++) {
        if ((options[i].selected)&&(i==0))
            break;            
        if (options[i].selected) {
            var optText = options[i-1].text;
            var optValue = options[i-1].value;
            options[i-1].text = options[i].text;
            options[i-1].value = options[i].value;
            options[i].text = optText;
            options[i].value = optValue;
            options[i-1].selected = true;
            options[i].selected = false;
        }
    }
}

function doMoveDown() {

    var options = myForm.mySelect.options

    for (i=options.length-1; i >= 0; i--) {
        if ((options[i].selected)&&(i==options.length-1))
            break;            
        if (options[i].selected) {
            var optText = options[i+1].text;
            var optValue = options[i+1].value;
            options[i+1].text = options[i].text;
            options[i+1].value = options[i].value;
            options[i].text = optText;
            options[i].value = optValue;
            options[i+1].selected = true;
            options[i].selected = false;
        }
    }
}

function doRemoveLinks2() {
    var options = myForm.mySelect2.options;
    for (i=0; i < options.length; i++) {
        if (options[i].selected)
        {
            options[i] = null; i--;
        }
    }
}

function doMoveUp2() {

    var options = myForm.mySelect2.options

    for (i=0; i < options.length; i++) {
        if ((options[i].selected)&&(i==0))
            break;            
        if (options[i].selected) {
            var optText = options[i-1].text;
            var optValue = options[i-1].value;
            options[i-1].text = options[i].text;
            options[i-1].value = options[i].value;
            options[i].text = optText;
            options[i].value = optValue;
            options[i-1].selected = true;
            options[i].selected = false;
        }
    }
}

function doMoveDown2() {

    var options = myForm.mySelect2.options

    for (i=options.length-1; i >= 0; i--) {
        if ((options[i].selected)&&(i==options.length-1))
            break;            
        if (options[i].selected) {
            var optText = options[i+1].text;
            var optValue = options[i+1].value;
            options[i+1].text = options[i].text;
            options[i+1].value = options[i].value;
            options[i].text = optText;
            options[i].value = optValue;
            options[i+1].selected = true;
            options[i].selected = false;
        }
    }
}

function doSubmit() {
 
    var options = myForm.mySelect.options;
    for (i=0; i < options.length; i++) {
        options[i].selected = true;
    }

    var options = myForm.mySelect2.options;
    for (i=0; i < options.length; i++) {
        options[i].selected = true;
    }

    myForm.submit();

}

// -->
</script>

<script language="C#" runat="server">

  public int selectSize = 5;
  public int pageIndex = 0;
  public Hashtable moduleTable;

    private void BuildModuleList(HtmlSelect list, String Modules) {

        if ((Modules == null)||(Modules == "")||(Modules == "System.DBNull"))
           return;

        String [] ModuleList = Modules.Split(new char[] {';'});

        for (int i=0;i<ModuleList.Length;i++) {
           String moduleSource = ModuleList[i]; 
           if (moduleSource != null &&  moduleSource !="") {
                list.Items.Add( new ListItem(moduleTable[moduleSource].ToString(), moduleSource));
           }
        }
    }

  protected void Page_Load(Object sender, EventArgs e) { 

      if (Request.Cookies["_PageIndex"] != null) 
          pageIndex = Int32.Parse(Request.Cookies["_PageIndex"].Value);

      if (String.Compare(Request.HttpMethod,"Post" , true) != 0 )
      {
          String dsn = (String) ((Hashtable) Context.GetConfig("dsnstore"))["portaldb"];
          SQLDataSetCommand myAdapter = new SQLDataSetCommand();

          myAdapter.SelectCommand  = new SQLCommand();
          myAdapter.SelectCommand.ActiveConnection = new SQLConnection(dsn);
          myAdapter.SelectCommand.CommandType = CommandType.StoredProcedure;
          myAdapter.SelectCommand.CommandText = "GetPublicModules";

          DataSet myDataSet = new DataSet();
          myAdapter.FillDataSet(myDataSet, "Results");

          DataView Source = myDataSet.Tables[0].DefaultView;

          moduleTable = new Hashtable();
          for (int i=0; i<Source.Count; i++) 
          {          
              String moduleName = Source[i]["Name"].ToString();
              String moduleSource = Source[i]["Source"].ToString(); 
              moduleTable[moduleSource] = moduleName;
          }

          BuildModuleList(mySelect, UserState["PageModules_" + pageIndex + "L"]);
          BuildModuleList(mySelect2, UserState["PageModules_" + pageIndex + "R"]);

          String pageNames = UserState["PageNames"];

          if (pageNames == null)
             return;

          String [] pageList = pageNames.Split(new char[] { ';' });

          pageName.InnerHtml = pageList[pageIndex];

      } 
      else
      {
         char[] semi = {';'};

         String [] leftModuleList = {""};
         String leftModules = Request.Form["mySelect"];
         if (leftModules != null)
             leftModuleList = leftModules.Split(new char[] {','});

         String sLeft = "";
         for (int i=0; i<leftModuleList.Length; i++)
             sLeft += leftModuleList[i] + ";";

         String [] rightModuleList = {""};
         String rightModules = Request.Form["mySelect2"];
         if (rightModules != null)
             rightModuleList = rightModules.Split(new char[] {','});

         String sRight = "";
         for (int i=0; i<rightModuleList.Length; i++)
             sRight += rightModuleList[i] + ";";

         if (String.Compare(UserState["UserId"],"ANONYMOUS") != 0) 
         {
             UserState["PageModules_" + pageIndex + "L"] = sLeft.TrimEnd(semi);
             UserState["PageModules_" + pageIndex + "R"] = sRight.TrimEnd(semi);
         }

         Response.Redirect("/quickstart/aspplus/samples/portal/default.htm");
      }

  }

</script>

</head>

<body bgcolor="ffffff" style="margin:0,0,0,0">

<PageHeader:PageHeader runat="server"/>

<!--BEGIN HEADER-->
    <table width="100%" cellpadding=5 cellspacing=0>
      <tr bgcolor="ffffff">
         <td align="left" colspan=2 bgcolor="<%= UserState["HeadColor"] %>" style="padding:10,0,10,15;border-color:black;border-style:solid; border-width:1;border-left:0;border-right:0;border-bottom:0">
             <font face="Arial" color="white"><b>Customize Page Layout</b></font>
         </td>
      </tr>
      <tr bgcolor="ffffff">
         <td align="left" colspan=2 height="25" style="padding:0,0,0,0;border-color:black;border-style:solid; border-width:1;border-left:0;border-right:0">
<!--END HEADER-->

<form name="myForm" method="post">

<center>

&nbsp;<br>

<font face="Arial" color="black"><b>Re-order the "<span id="pageName" runat="server"/>" modules, then click "Submit Changes" to accept settings</b></font>

<table cellspacing="15">
<tr>
<td width="50%">

<table width="100%" cellspacing=0 style="border-color:black;border-style:solid;border-width:1">
<tr>
        <td bgcolor=<%= UserState["HeadColor"] %> style="border-color:black;border-style:solid;border-width:1;border-top:0;border-left:0;border-right:0;padding:10,10,10,10" align="left">
            <font face="Arial" color="white"><b>Left Modules</b></font>
        </td>
</tr>
    <tr>
        <td align="center" width="100%" colspan=2 bgcolor="<%= UserState["SubheadColor"]%>">
            <table cellpadding=0 width="100%" cellspacing=0 style="border-color:<%= UserState["SubheadColor"]%>;border-style:solid;border-width:10">
                <tr>
                    <td valign="center" width="30">
                        <button style="border-width:0,0,0,0;background-color:<%= UserState["SubheadColor"]%>" onclick="javascript:doMoveUp()"><img src="../../../../aspplus/samples/portal/images/up.gif"></button>
                        <button style="border-width:0,0,0,0;background-color:<%= UserState["SubheadColor"]%>" onclick="javascript:doRemoveLinks()"><img src="../../../../aspplus/samples/portal/images/x.gif"></button>
                        <button style="border-width:0,0,0,0;background-color:<%= UserState["SubheadColor"]%>" onclick="javascript:doMoveDown()"><img src="../../../../aspplus/samples/portal/images/down.gif"></button>
                    </td>
                    <td valign="top">
                        <select id="mySelect" name="mySelect" MaintainState="false" multiple databinding="size:selectSize" runat="server"/>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>


</td>
<td width="50%">

<table width="100%" cellspacing=0 style="border-color:black;border-style:solid;border-width:1">
<tr>
        <td bgcolor="<%= UserState["HeadColor"]%>" style="border-color:black;border-style:solid;border-width:1;border-top:0;border-left:0;border-right:0;padding:10,10,10,10" align="left">
            <font face="Arial" color="white"><b>Right Modules</b></font>
        </td>
</tr>
    <tr>
        <td align="center" width="100%" colspan=2 bgcolor="<%= UserState["SubheadColor"]%>">
            <table cellpadding=0 width="100%" cellspacing=0 style="border-color:<%= UserState["SubheadColor"]%>;border-style:solid;border-width:10">
                <tr>
                    <td valign="center" width="30">
                        <button style="border-width:0,0,0,0;background-color:<%= UserState["SubheadColor"]%>" onclick="javascript:doMoveUp2()"><img src="../../../../aspplus/samples/portal/images/up.gif"></button>
                        <button style="border-width:0,0,0,0;background-color:<%= UserState["SubheadColor"]%>" onclick="javascript:doRemoveLinks2()"><img src="../../../../aspplus/samples/portal/images/x.gif"></button>
                        <button style="border-width:0,0,0,0;background-color:<%= UserState["SubheadColor"]%>" onclick="javascript:doMoveDown2()"><img src="../../../../aspplus/samples/portal/images/down.gif"></button>
                    </td>
                    <td valign="top">
                        <select id="mySelect2" name="mySelect"   multiple databinding="size:selectSize" runat="server"/>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>


</td>
</tr>


</table>

</center>

<p>

<table width="100%" cellpadding="0" cellspacing="0" bgcolor="<%=  UserState["SubheadColor"]%>">
<tr><td align="center" width="100%" style="padding:10,10,10,10;border-color:black;border-style:solid;border-width:1;border-left:0;border-bottom:0;border-right:0;" >
    
    <input type="button" value="Submit Changes" onclick="doSubmit()" >

</td></tr>
</table>

</td>
</tr>
</table>

</form>
</body>
</html>

</xmp>
        <span id="ErrorMessage" style="color:red"></span>

    </form>
