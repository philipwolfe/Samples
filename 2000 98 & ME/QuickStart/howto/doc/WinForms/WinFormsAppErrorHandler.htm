


<!--BEGIN HEADER-->
<html>
<head>
<link rel="stylesheet" href="../../../include/qsstyle.css">
</head>
<body topmargin="0" leftmargin="0" marginwidth="0" marginheight="0" >

<table class="outer" cellpadding=0 cellspacing=0>
<tr>
<td class="toc" valign="top" width="210">

<table>
<tr>
<td nowrap style="padding-right:15">

<div class="toc" style="font-size:8pt;color:darkred;">

    <div style="padding:0,0,4,0"><b>Windows Forms</b><br></div>
    &nbsp; <a class="outer" href="../../../howto/doc/winforms/winformsapperrorhandler.htm">A default error handler</a><br>
    &nbsp; <a class="outer" href="../../../howto/doc/winforms/winformsownerdrawlistbox.htm">An Owner-drawn ListBox</a><br>
    &nbsp; <a class="outer" href="../../../howto/doc/winforms/winformsthreadmarshalling.htm">Call across thread boundaries</a><p>
    <div style="padding:0,0,4,0"><a target="_top" style="color:darkred" href="../../../howto"><b>Back to Index</b></a><br></div>






</div>

</td>
</tr>
</table>






</td>
<td valign="top">
<div class="body">
<!--END HEADER-->

<style>
.mydd {  font: smaller verdana; }
.code1 {
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	background:#DFDFDF;
	font-family:"Courier New";
	color:blue;
	}
.codecomment1 {
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	background:#DFDFDF;
	font-family:"Courier New";
	color:green;
	}
.issue {
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	background-color:RED;
	color:WHITE;
	font-weight:bold;
	}


body { font: smaller verdana }        

</style>





<h4>Adding an error handler for untrapped exceptions</h4>

<P>In your application design you may want to register an exception 
handler for any exceptions you have not handled in your application.  You 
can do create an exception handler for your unhandled exceptions by 
calling the <B>Application.AddOnThreadException</B> method and passing in 
a reference to a method in your application.  This method will then be 
called for any unhandled exceptions on that thread.  The 
<B>OnThreadException</B> event is raised when the Windows Forms window 
procedure receives an exception.</P> 
      
<P>Windows Forms provides a default exception handler and exception handling 
dialog named <B>ThreadExceptionDialog</B>.  This dialog works is typically 
used during development, but you will want to supply your own custom 
exception handlers for your application when it is near completion.</P> 

<P>The following example demonstrates how to create a very simple custom 
exception handler that displays the exception message and stack trace in a 
<b>MessageBox</b>:</P> 

<p>
  <script language="JavaScript">
    function doClick(index, id) {
        var numTabs = 1;
        document.all("tab" + id, index).className = "tab";
        for (var i=1; i < numTabs; i++) {
            document.all("tab" + id, (index + i) % numTabs).className = "backtab";
        }
        document.all("code" + id, index).style.display = "";
        for (var j=1; j < numTabs; j++) {
          document.all("code" + id, (index + j) % numTabs).style.display = "none";
        }
    }
  </script>
  <style>
    td.code {
      padding:0,10,0,10;
      border-style:solid;
      border-width:1;
      border-bottom:0;
      border-top:0;
      border-right:0;
      border-color:cccccc;
      background-color:ffffee
    }
    td.tab {
      text-align:center;
      font:8pt verdana;
      width:15%;
      padding:3,3,3,3;
      border-style:solid;
      border-width:1;
      border-right:0;
      border-color:black;
      background-color:eeeeee
    }
    td.backtab {
      text-align:center;
      font: 8pt verdana;
      width:15%;
      padding:3,3,3,3;
      border-style:solid;
      border-width:1;
      border-right:0;
      border-color:black;
      background-color:cccccc
    }
    td.space {
      width:85%;
      font: 8pt verdana;
      padding:0,0,0,0;
      border-style:solid;
      border-bottom:0;
      border-right:0;
      border-width:1;
      border-color:cccccc;
      border-left-color:black;
      background-color:white
    }
  </style>
    <table cellpadding=0 cellspacing=0 width="95%">
      <tr>
        <td class="code" colspan="2">
<pre id="codectrl4" style="display:">

//The Error Handler class
//We need a class because event handling methods can't be static
internal class CustomExceptionHandler {

    //Handle the exception event
    public void OnThreadException(object sender, ThreadExceptionEventArgs t) {

        DialogResult result = DialogResult.Cancel;
        try {
            result = this.ShowThreadExceptionDialog(t.exception);
        }
        catch {
            try {
                MessageBox.Show("Fatal Error", "Fatal Error", MessageBox.IconStop|MessageBox.AbortRetryIgnore);
            }
            finally {
                Application.Exit();
            }
        }

        if (result == DialogResult.Abort) 
            Application.Exit();

    }

    //The simple dialog that is displayed when this class catches and exception
    private DialogResult ShowThreadExceptionDialog(Exception e) {
        string errorMsg = "An error occurred please contact the adminstrator with the following information:\n\n";
        errorMsg = errorMsg + e.Message + "\n\nStack Trace:\n" + e.StackTrace;
        return MessageBox.Show(errorMsg, "Application Error", MessageBox.IconStop|MessageBox.AbortRetryIgnore);
    }
}

....
    
//Register the custom error handler as soon as we can in Main
//to make sure that we catch as many exceptions as possible
public static void Main(string[] args) {
    CustomExceptionHandler eh = new CustomExceptionHandler();
    Application.AddOnThreadException(new ThreadExceptionEventHandler(eh.OnThreadException));
    Application.Run(new ErrorHandler());
}
</pre>
        </td>
      </tr>
      <tr>
        <td class="tab" id="tabctrl4" onclick="doClick(0, 'ctrl4')">
          <b>C#
        </td>
        <td class="space">&nbsp;</td>
      </tr>
    </table>
<p>

<br><Br>

<span>
    
    
    

        

<div class="indent">



	<a target="_blank" href="../../../howto/samples/winforms/cs/errorhandler">
	<img style="border-color:black" border=1 src="../../../winforms/images/wflink.jpg"><br>
	</a>
	<div class="caption">C# Error Handling Sample</div><br>
	
	
		[<a target="_blank" href="../../../howto/samples/winforms/cs/errorhandler">Run Sample</a>] | 
		[<a target="_blank" href="../../../howto/samples/winforms/cs/errorhandler/errorhandlercssource.htm">View Source</a>]
	
	
	</div>


    </span>


<!--END FOOTER-->
<p>
<hr>
<p>
</div>
</td>
</tr>
</table>
</BODY>
</html>
<!--END FOOTER-->