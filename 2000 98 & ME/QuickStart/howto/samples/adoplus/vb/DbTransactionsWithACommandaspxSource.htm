



    <link rel="stylesheet" href="../../../../util/style.css">

    <form name="Form" method="post" action="srcview.htm?path=/QuickStart/howto/samples/adoplus/vb/dbtransactionswithacommand.src&file=DbTransactionsWithACommand.htm" id="Form">
<input type="hidden" name="__VIEWSTATE" value="YTB6MTQ3MzAyNjM4MF9hMHpfaHo1ejN4X2Ewel9oejV6MHhfYTB6aHppbm5lcmh0bWxfRGJUcmFuc2FjdGlvbnNXaXRoQUNvbW1hbmQuYXNwXHh4X194eF94eF94X194d2281224" />


        <div class="SampleHeader" style="width:100%">
            <div class="SampleTitle">
                <span id="Title">DbTransactionsWithACommand.htm</span>
            </div>
            <table id="SourceTable" style="font: 8pt Verdana">
    <tr>
        <td style="padding-right:10;"><b>VB Source: </b></td>
        <td><a href='../../../../howto/samples/adoplus/vb/dbtransactionswithacommandaspxsource.htm'>DbTransactionsWithACommand.htm</a> &nbsp;&nbsp</td>
    </tr>
    <tr>
        <td style="padding-right:10;"><b>C# Source: </b></td>
        <td><a href='../../../../howto/samples/adoplus/cs/dbtransactionswithacommandaspxsource.htm'>..\CS\DbTransactionsWithACommand.htm</a> &nbsp;&nbsp</td>
    </tr>
</table>

        </div>

        <xmp>
<%@ Import Namespace="System.Data" %>
<%@ Import Namespace="System.Data.SQL" %>

<html>

<script language="VB" runat="server">

  protected sub Page_Load(Src as Object, E as EventArgs ) 


    Dim myConnection as SQLConnection
    myConnection = new SQLConnection("server=localhost;uid=sa;pwd=;database=northwind")


    Dim myCommand as SQLCommand
    myCommand = new SQLCommand("Insert into Region (RegionID, RegionDescription) VALUES (100, 'Description')", myConnection)

    Cleanup(myConnection) '// restore database to near it's original condifition so sample will work correctly.

    try

      myConnection.Open()
      myConnection.BeginTransaction()
      myCommand.ExecuteNonQuery()
      myCommand.CommandText = "Insert into Region (RegionID, RegionDescription) VALUES (101, 'Description')"
      myCommand.ExecuteNonQuery()
      myConnection.CommitTransaction()
      Response.Write("Both Records written to database")

    catch myException as Exception

      myConnection.RollbackTransaction()
      Response.Write(myException.ToString())
      Response.Write("<p><p>Neither record written to database.  This will happen if you executed this page more than once.  Executing the page more than once may exibit the Rollback behavior.")

    finally

      myConnection.Close()

    end try

  end sub


  protected sub Cleanup(myConnection as SQLConnection )

    dim myCommand as SQLCommand
    
    myConnection.Open()
    myCommand = new SQLCommand("DELETE FROM Region WHERE (RegionID = 100) OR (RegionID = 101)", myConnection)
    myCommand.ExecuteNonQuery()
    myConnection.Close()

  end sub
</script>

</BODY>
</HTML>
</xmp>
        <span id="ErrorMessage" style="color:red"></span>

    </form>
ed"></span>

    </form>
