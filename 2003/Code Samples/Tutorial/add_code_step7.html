<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head><title>Add Code: Step 7 of 7</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><link href="Styles/tutorial.css" rel="stylesheet" type="text/css"><script LANGUAGE = "JavaScript1.3">

<!--
if (document.images) {
	MainNavon = new Image();		// Active images
	MainNav2on = new Image();
	MainNav3on = new Image();
	MainNav4on = new Image();
	MainNav5on = new Image();
	MainNav6on = new Image();
	MainNav7on = new Image();
	MainNav8on = new Image();
	HomeTabon = new Image();
	FeedbackTabon = new Image();
	
	MainNavon.src = "images/web_apps_over.gif";
	MainNav2on.src = "images/mobile_apps_over.gif";
	MainNav3on.src = "images/web_services_over.gif";
	MainNav4on.src = "images/data_access_over.gif";
	MainNav5on.src = "../../../images/web_hosters_over.gif";
	MainNav6on.src = "images/third_party_over.gif";
	MainNav7on.src = "images/asp_upgrade_over.gif";
	MainNav8on.src = "images/additional_resources_over.gif";
	HomeTabon.src = "images/home_over.gif";
	FeedbackTabon.src = "images/feedback_over.gif";
	
	MainNavoff = new Image();		// Inactive images
	MainNav2off = new Image();
	MainNav3off = new Image();
	MainNav4off = new Image();
	MainNav5off = new Image();
	MainNav6off = new Image();
	MainNav7off = new Image();
	MainNav8off = new Image();
	HomeTaboff = new Image();
	FeedbackTaboff = new Image();
	
	MainNavoff.src = "images/web_apps_up.gif";
	MainNav2off.src = "images/mobile_apps_up.gif";
	MainNav3off.src = "images/web_services_up.gif";
	MainNav4off.src = "images/data_access_up.gif";
	MainNav5off.src = "../../../images/web_hosters_up.gif";
	MainNav6off.src = "images/third_party_up.gif";
	MainNav7off.src = "images/asp_upgrade_up.gif";
	MainNav8off.src = "images/additional_resources_up.gif";
	HomeTaboff.src = "images/home_up.gif";
	FeedbackTaboff.src = "images/feedback_up.gif";

}

function imgOn(imgName) {
	if (document.images) {
		document[imgName].src = eval(imgName + "on.src");
	}
}

function imgOff(imgName) {
	if (document.images) {
	document[imgName].src = eval(imgName + "off.src");
	}
}
// -->
</script>

</head>


<div id="container">
	<div id="banner">
		<div id="tabs"><a href="../../../default.htm" onMouseOver="imgOn('HomeTab')" onMouseOut="imgOff('HomeTab')"><img src="../../../images/home_up.gif" name="HomeTab" border="0" width="73" height="23"></a><a href="mailto:asprk@microsoft.com" onMouseOver="imgOn('FeedbackTab')" onMouseOut="imgOff('FeedbackTab')"><img src="../../../images/feedback_up.gif" name="FeedbackTab" border="0" width="96" height="23"></a></div>
	</div>
	<div id="navcontainer">
		<div id="nav">
			<a href="../../../Web Applications/web_apps.htm" onMouseOver="imgOn('MainNav')" onMouseOut="imgOff('MainNav')"><img src="../../../images/web_apps_up.gif" name="MainNav" border="0" width="88" height="76"></a><a href="../../../Mobile Applications/MobileApps.htm" onMouseOver="imgOn('MainNav2')" onMouseOut="imgOff('MainNav2')"><img src="../../../images/mobile_apps_up.gif" name="MainNav2" border="0" width="86" height="76"></a><a href="../../../Web Services/web_services.htm" onMouseOver="imgOn('MainNav3')" onMouseOut="imgOff('MainNav3')"><img src="../../../images/web_services_up.gif" name="MainNav3" border="0" width="87" height="76"></a><a href="../../../Data Access/data_access.htm" onMouseOver="imgOn('MainNav4')" onMouseOut="imgOff('MainNav4')"><img src="../../../images/data_access_up.gif" name="MainNav4" border="0" width="83" height="76"></a><a href="../../../Web Hosters/webhosters.htm" onMouseOver="imgOn('MainNav5')" onMouseOut="imgOff('MainNav5')"><img src="../../../images/web_hosters_up.gif" name="MainNav5" border="0" width="105" height="76"></a><a href="../../../Third Party Components/thirdParty.htm" onMouseOver="imgOn('MainNav6')" onMouseOut="imgOff('MainNav6')"><img src="../../../images/third_party_up.gif" name="MainNav6" border="0" width="83" height="76"></a><a href="../../../ASP Upgrade/ASPupgrade.htm" onMouseOver="imgOn('MainNav7')" onMouseOut="imgOff('MainNav7')"><img src="../../../images/asp_upgrade_up.gif" name="MainNav7" border="0" width="91" height="76"></a><a href="../../../Additional Resources/resources.htm" onMouseOver="imgOn('MainNav8')" onMouseOut="imgOff('MainNav8')"><img src="../../../images/additional_resources_up.gif" name="MainNav8" border="0" width="85" height="76"></a>
		</div>
	</div>
	<div id="graybar"></div>
	<div id="content"> 
	<div id="subapp">		<div id="subapptop"><a href="create_project_step1.html"><img src="images/create_project_up.gif" border="0" width="103" height="44"></a><a href="add_controls_step1.html"><img src="images/add_controls_up.gif" border="0" width="99" height="44"></a><a href="format_form_step1.html"><img src="images/format_form_up.gif" border="0" width="117" height="44"></a><img src="images/bind_data_up.gif" border="0" width="83" height="44"><img src="images/add_code_down.gif" border="0" width="81" height="44"><a href="run_app_step1.html"><img src="images/run_app_up.gif" border="0" width="130" height="44"></a></div>				<div id="subappbottom"><a href="add_code_step1.html" class="subapplink">Introduction</a>&nbsp;|&nbsp;<a href="add_code_step2.html" class="subapplink">Page Load</a>&nbsp;|&nbsp;<a href="add_code_step3.html" class="subapplink">Calendars</a>&nbsp;|&nbsp;<a href="add_code_step4.html" class="subapplink">ButtonClick</a>&nbsp;|&nbsp;<a href="add_code_step5.html" class="subapplink">Format Date</a>&nbsp;|&nbsp;<a href="add_code_step6.html" class="subapplink">Datagrid Paging</a>&nbsp;|&nbsp;<a href="add_code_step7.html" class="subapplink">Datagrid Editing</a></div>	</div>	<div id="orangebox">		<div id="orangetop">Learn More</div>		<div id="orangemiddle">			<p>Lots of information about <a target="_blank" class="orangelink" href="http://samples.gotdotnet.com/quickstart/aspplus/doc/webdataaccess.aspx">editing the Datagrid</a> in the ASP.NET QuickStarts</p>			<p>Here are the <a target="_blank" class="orangelink" href="http://msdn.microsoft.com/library/en-us/dv_vstechart/html/vbtchTopQuestionsAboutASPNETDataGridServerControl.asp?frame=true">top questions</a> people ask about the DataGrid</p>		</div>		<div id="orangebottom"></div>	</div>	<h3>Step 7 of 7: Datagrid Editing</h3>	<p>The DataGrid has built-in support for editing of data. The EditCommandColumn has already been added using the PropertyBuilder. The code to get this all to work 	is actually surprisingly simple.</p>		<ol>			<li>When the Edit link is clicked, the DataGrid is put into Edit mode. The <b>EditItemIndex</b> of the DataGrid determines which row is currently being edited.</li>			<br>			<li>Setting the EditItemIndex to <b>-1</b> puts the DataGrid back into standard display mode. We do this to cancel editing and also after we are finished editing.</li>			<br>			<li>Paste the dgOrders_CancelCommand code for the CancelCommand.</li>		

<pre><font color=blue>Private</font> <font color=blue>Sub</font> dgOrders_CancelCommand(<font color=blue>ByVal</font> source <font color=blue>As</font> Object, _
      <font color=blue>ByVal</font> e <font color=blue>As</font> System.Web.UI.WebControls.DataGridCommandEventArgs) _
      <font color=blue>Handles</font> dgOrders.CancelCommand

dgOrders.EditItemIndex = -1
BindGrid()

<font color=blue>End</font> <font color=blue>Sub</font>
</pre>
			<li>Paste the dgOrders_EditCommand code for the EditCommand.</li>			<br>			<li>Paste the dgOrders_UpdateCommand to update of the XML file.		<pre><font color=blue>Private</font> <font color=blue>Sub</font> dgOrders_EditCommand(<font color=blue>ByVal</font> source <font color=blue>As</font> Object, _
        <font color=blue>ByVal</font> e <font color=blue>As</font> System.Web.UI.WebControls.DataGridCommandEventArgs) _
        <font color=blue>Handles</font> dgOrders.EditCommand

        dgOrders.EditItemIndex = e.Item.ItemIndex
        BindGrid()

    <font color=blue>End</font> <font color=blue>Sub</font>

    <font color=blue>Private</font> <font color=blue>Sub</font> dgOrders_UpdateCommand(<font color=blue>ByVal</font> source <font color=blue>As</font> Object, _
        <font color=blue>ByVal</font> e <font color=blue>As</font> System.Web.UI.WebControls.DataGridCommandEventArgs) _
        <font color=blue>Handles</font> dgOrders.UpdateCommand


        <font color=blue>Dim</font> key <font color=blue>As</font> <font color=blue>Integer</font> = _
          Convert.ToInt32(dgOrders.DataKeys(e.Item.ItemIndex))
        <font color=blue>Dim</font> r <font color=blue>As</font> dsCustOrder.OrdersRow

        r = dsOrders.Orders.FindByOrderID(key)

        r.CustomerID = CType(e.Item.Cells(2).Controls(0), TextBox).Text
        r.OrderDate = _
          Convert.ToDateTime(CType(e.Item.Cells(3).Controls(0), TextBox).Text)
        r.ShipName = CType(e.Item.Cells(4).Controls(0), TextBox).Text
        r.ShipAddress = CType(e.Item.Cells(5).Controls(0), TextBox).Text
        r.ShipCity = CType(e.Item.Cells(6).Controls(0), TextBox).Text
        r.ShipRegion = CType(e.Item.Cells(7).Controls(0), TextBox).Text
        r.ShipPostalCode = CType(e.Item.Cells(8).Controls(0), TextBox).Text

        dsOrders.AcceptChanges()
        dsOrders.WriteXml(Server.MapPath(<font color=black>"CustOrder.xml"</font>))

        dgOrders.EditItemIndex = -1

        FilterOrders()

<font color=blue>End</font> <font color=blue>Sub</font>
</pre></li>		</ol>	</p>	<p><a href="add_code_step6.html" class="next">Previous Step</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="run_app_step1.html" class="next">Next Step</a></p>	</div>	<div id="footer">&copy;2003 Microsoft Corporation. All rights reserved.</div></div><body></body></html>